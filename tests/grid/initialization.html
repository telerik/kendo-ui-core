<!DOCTYPE html>
<html>
    <head>
        <title>Grid Initialization</title>
        <script src="../../src/jquery.js"></script>
        <script type="text/javascript" src="../qunit/qunit/qunit.js"></script>
        <script type="text/javascript" src="../qunit-runner.js"></script>
        <script src="../../src/kendo.core.js"></script>
        <script src="../../src/kendo.popup.js"></script>
        <script src="../../src/kendo.list.js"></script>
        <script src="../../src/kendo.dropdownlist.js"></script>
        <script src="../../src/kendo.numerictextbox.js"></script>
        <script src="../../src/kendo.calendar.js"></script>
        <script src="../../src/kendo.datepicker.js"></script>
        <script src="../../src/kendo.data.js"></script>
        <script src="../../src/kendo.binder.js"></script>
        <script src="../../src/kendo.model.js"></script>
        <script src="../../src/kendo.pager.js"></script>
        <script src="../../src/kendo.sortable.js"></script>
        <script src="../../src/kendo.filtermenu.js"></script>
        <script src="../../src/kendo.grid.js"></script>
        <link rel="stylesheet" href="../qunit/qunit/qunit.css" type="text/css" />
    </head>
    <body>
        <h1 id="qunit-header">Grid Initialization</h1>
        <h2 id="qunit-banner"></h2>
        <div id="qunit-testrunner-toolbar"></div>
        <h2 id="qunit-userAgent"></h2>
        <ol id="qunit-tests"></ol>
        <script>
            kendo.ns = "kendo-";
            var Grid = kendo.ui.Grid,
                table,
                DataSource = kendo.data.DataSource;

            module("grid initialziation", {
                setup: function() {
                    table = document.createElement("table");
                    document.body.appendChild(table);
                },
                teardown: function() {
                    $(table).closest(".k-grid").remove();
                }
            });

            test("kendoGrid attaches a grid object to target", function() {
                var table = $("<table />").kendoGrid({ dataSource: [] });

                ok(table.data("kendoGrid") instanceof Grid);
            });

            test("Grid constructor calls the read method of its datasource", function() {
                var dataSource = new DataSource({ dataSource: [] });
                var readWasCalled = false;

                dataSource.read = function() {
                    readWasCalled = true;
                };

                new Grid(table, { dataSource: dataSource } );

                ok(readWasCalled);
            });

            test("column initialization - field", function() {
                var grid = new Grid(table, { dataSource: [], columns: [{ field: "foo" }, { field: "bar" }] });

                equal(grid.columns.length, 2);
                equal(grid.columns[0].field, "foo");
                equal(grid.columns[1].field, "bar");
            });

            test("column initialization - template", function() {
                var grid = new Grid(table, { dataSource: [], columns: [{ field: "foo", template: "bar" }] });

                equal(grid.columns[0].field, "foo");
                equal(grid.columns[0].template, "bar");
            });

            test("column initialization - treating strings as fields", function() {
                var grid = new Grid(table, { dataSource: [], columns: ["foo", { field: "bar" }] });

                equal(grid.columns.length, 2);
                equal(grid.columns[0].field, "foo");
                equal(grid.columns[1].field, "bar");
            });

            test("header data attributes - data-kendo-field", function() {
                var grid = new Grid($('<table><th data-kendo-field="foo"></th><th data-kendo-field="bar"></th></table>')[0], { dataSource: [] });

                equal(grid.columns.length, 2);
                equal(grid.columns[0].field, "foo");
                equal(grid.columns[1].field, "bar");
            });

            test("header data attributes - data-kendo-type", function() {
                var grid = new Grid($('<table><th data-kendo-field="foo" data-kendo-type="number"></th><th data-kendo-field="bar"></th></table>')[0], { dataSource: [] });

                equal(grid.columns.length, 2);
                equal(grid.columns[0].type, "number");
                equal(grid.columns[1].type, undefined);
            });

            test("header data attributes - data-kendo-template", function() {
                var grid = new Grid($('<table><th data-kendo-field="foo" data-kendo-template="bar"></th></table>')[0], { dataSource: [] });

                equal(grid.columns[0].field, "foo");
                equal(grid.columns[0].template, "bar");
            });

            test("column format is applied", function() {
                var grid = new Grid(table, { dataSource: [ {foo: "foo"}, {foo: "bar"}], columns: [{ field: "foo", format: "{0} bar" }] });

                equal(grid.table.find("tr:first>td").text(), "foo bar");
                equal(grid.table.find("tr:nth(1)>td").text(), "bar bar");
            });

            test("column format with sharps is applied", function() {
                var grid = new Grid(table, { dataSource: [ {foo: 123}, {foo: 423 }], columns: [{ field: "foo", format: "{0:###.0}" }] });

                equal(grid.table.find("tr:first>td").text(), "123.0");
                equal(grid.table.find("tr:nth(1)>td").text(), "423.0");
            });

            test("column initialization - groupable", function() {
                var grid = new Grid(table, { dataSource: [], columns: [{ field: "foo", groupable: true }] });

                equal(grid.columns[0].field, "foo");
                ok(grid.columns[0].groupable);
            });

            test("column initialization - groupable disabled", function() {
                var grid = new Grid(table, { dataSource: [], columns: [{ field: "foo", groupable: false}] });

                equal(grid.columns[0].field, "foo");
                ok(!grid.columns[0].groupable);
            });

            test("column initialization - groupable attr is set for th", function() {
                var grid = new Grid(table, { dataSource: [], columns: [{ field: "foo", groupable: false}] });

                ok(grid.thead.find("th:first").attr(kendo.attr("groupable")) === "false");
            });

            test("column initialization - data-kendo-groupable", function() {
                var grid = new Grid($('<table><th data-kendo-field="foo" data-kendo-groupable="true"></th></table>')[0], { dataSource: [] });

                equal(grid.columns[0].field, "foo");
                ok(grid.columns[0].groupable);
            });

            test("tbody is created if not present", function() {
                var grid = new Grid(table, { dataSource: [], columns: [{ field: "foo", template: "item.foo" }] });
                equal(grid.tbody.length, 1);
            });

            test("array passed as options is treated as data", function() {
                var data = ["foo"];
                var grid = new Grid(table, data);
                ok(grid.dataSource.data()[0] === data[0]);
            });

            test("div wrapper is created around the table", function() {
                var grid = new Grid(table, []);

                ok(grid.wrapper.is("div.k-grid.k-widget"));
            });

            test("wrapper field is initialized", function() {
                var grid = new Grid(table, []);

                ok(grid.wrapper.is("div.k-grid.k-widget"));
            });

            test("datasource is populated from table if not specified", function() {
                var grid = new Grid($('<table><tr><td /><td/></tr></table>'), {columns: [ { field:"foo" }] });

                equal(grid.dataSource.data().length, 1);
            });

            test("header text is used as a field if data-kendo-field attribute is not set", function() {
                var grid = new Grid($('<table><th>Foo</th></table>'));

                equal(grid.columns[0].field, "Foo");
            });

            test("data-kendo-field takes precedence over the header text", function() {
                var grid = new Grid($('<table><th data-kendo-field="foo">Foo</th></table>'));

                equal(grid.columns[0].field, "foo");
            });

            test("everything which is not alpha numeric is stripped from header text when used as a field", function() {
                var grid = new Grid($('<table><th>  $@Foo1   Bar   </th></table>'));

                equal(grid.columns[0].field, "Foo1Bar");
            });

            test("initializing a grid from a div", function() {
                var div = $("<div />"), grid = new Grid(div, {scrollable: false, dataSource: [] });

                ok(grid.element[0] === div[0]);
                ok(div.children().first().is("table"));
                ok(grid.table[0] === div.children().first()[0]);
            });

            test("initializing a scrollable grid from a div", function() {
                var div = $("<div />"), grid = new Grid(div, { dataSource: [] });

                ok(grid.element[0] === div[0]);
                equal(grid.table[0], div.find(".k-grid-content").children().first()[0]);
            });

            test("autogenerating columns", function() {
                var grid = new Grid(table, [ { foo: "foo", bar: "bar" } ]);

                equal(grid.columns.length, 2);
            });

            test("autogenerating columns - inferring the field", function() {
                var grid = new Grid(table, [ { foo: "foo", bar: "bar" } ]);

                equal(grid.columns[0].field, "foo");
                equal(grid.columns[1].field, "bar");
            });

            test("autogenerating columns - generating the templates", function() {
                var grid = new Grid(table, [ { foo: "foo", bar: "bar" } ]);

                equal(grid.tbody.find(">tr>td:first").text(), "foo");
                equal(grid.tbody.find(">tr>td:last").text(), "bar");
            });

            test("autogenerating columns - generating the th", function() {
                var grid = new Grid(table, { scrollable: false, dataSource: [ { foo: "foo", bar: "bar" } ] });

                equal(grid.table.find("tr>th:first").text(), "foo");
                equal(grid.table.find("tr>th:last").text(), "bar");
            });

            test("autogenerating columns - generating the th in scrollable grid", function() {
                var grid = new Grid(table, { scrollable: true, dataSource: [ { foo: "foo", bar: "bar" } ] });

                equal(grid.thead.find("tr>th:first").text(), "foo");
                equal(grid.thead.find("tr>th:last").text(), "bar");
            });

            test("generating the th from column metadata", function() {
                var grid = new Grid(table, { columns: [ { field: "foo" } ] });

                equal(grid.thead.find("tr>th:first").text(), "foo");
            });

            test("thead initialization", function() {
                var grid = new Grid(table, { columns: [ { field: "foo" } ] });

                equal(grid.thead.length, 1);
            });

            test("thead initialization when there is existing thead", function() {
                var grid = new Grid($("<table><thead/></table>"), { columns: [ { field: "foo" } ] });

                equal(grid.wrapper.find("thead").length, 1);
                equal(grid.thead.find("th").length, 1);
            });

            test("thead initialization when there is existing nested theads", function() {
                var grid = new Grid($("<table><thead/><tbody><tr><td><table><thead/></table></td></tr></tbody></table>"), { columns: [ { field: "foo" } ] });

                equal(grid.wrapper.find("thead").length, 2);
                equal(grid.thead.find("th").length, 1);
            });

            test("thead initialization when there is existing thead > tr", function() {
                var grid = new Grid($("<table><thead><tr/></thead></table>"), { columns: [ { field: "foo" } ] });

                equal(grid.wrapper.find("thead").length, 1);
                equal(grid.thead.find("tr").length, 1);
                equal(grid.thead.find("th").length, 1);
            });

            test("thead initialization when there is existing thead > tr > th", function() {
                var grid = new Grid($("<table><thead><tr><th>bar</th></tr></thead></table>"), { columns: [ { field: "foo" } ] });

                equal(grid.wrapper.find("thead").length, 1);
                equal(grid.thead.find("tr").length, 1);
                equal(grid.thead.find("th").length, 1);
                equal(grid.thead.find("th").text(), "bar");
            });

            test("thead initialization when there are nested g thead > tr > th", function() {
                var element = $("<table><thead><tr><th>bar</th></tr></thead><tbody><tr><td><table><thead><tr><th/></tr></thead></table></td></tr></tbody></table>");
                var grid = new Grid(element, { columns: [ { field: "foo" } ] });

                equal(grid.wrapper.find("thead").length, 2);
                equal(grid.thead.find("tr").length, 1);
                equal(grid.thead.find("th").length, 1);
                equal(grid.thead.find("th").text(), "bar");
            });

            test("thead initialization when there is no thead but th exists", function() {
                var grid = new Grid($("<table><tr><th>bar</th></tr></table>"), { });

                equal(grid.wrapper.find("thead").length, 1);
                equal(grid.wrapper.find("tr").length, 1);
                equal(grid.thead.find("th").length, 1);
                equal(grid.thead.find("th").text(), "bar");
            });
            test("autoBind false does not populate grid", function() {
                var grid = new Grid(table, { autoBind: false, dataSource: [ { foo: "foo", bar: "bar" } ]});

                ok(grid.element.find("tbody > tr").length == 0);
            });

            test("th css class is set", function() {
                var grid = new Grid($("<table><thead><tr><th /></tr></thead></table>"));

                equal(grid.thead.find(".k-header").length, grid.thead.find("th").length);
            });

            test("zero cellspacing is set", function() {
                var grid = new Grid($("<table><thead><tr><th /></tr></thead></table>"));

                equal(grid.table.attr("cellspacing"), "0");
            });

            test("scrollable grid has a div for the header", function() {
                var grid = new Grid($("<table><thead><tr><th /></tr></thead></table>"), { scrollable: true });

                equal(grid.wrapper.children().filter("div.k-grid-header").length, 1);
            });

            test("scrollable grid has a table with thead in the header", function() {
                var grid = new Grid($("<table><thead><tr><th /></tr></thead></table>"), { scrollable: true });

                equal(grid.wrapper.children().filter("div").find("table > thead").length, 1);
            });

            test("scrollable grid has only one header when columns are autogenerated", function() {
                var grid = new Grid($("<table />"), { scrollable: true, dataSource: [{foo:"bar"}] });

                equal(grid.wrapper.children().filter("div.k-grid-header").find("table > thead").length, 1);
            });

            test("scrollable grid header has right padding the same as the scrollbar width", function() {
                var grid = new Grid($("<table />"), { scrollable: true, dataSource: [{foo:"bar"}] });

                equal(grid.wrapper.children().filter("div.k-grid-header").css("padding-right"), kendo.support.scrollbar() + "px");
            });

            test("scrollable grid has header wrap", function() {
                var grid = new Grid($("<table />"), { scrollable: true, dataSource: [{foo:"bar"}] });

                equal(grid.wrapper.children().filter("div.k-grid-header").find("> div.k-grid-header-wrap").length, 1);
            });

            test("scrollable grid table is nested in a div", function() {
                var grid = new Grid($("<table />"), { scrollable: true, dataSource: [{foo:"bar"}] });

                ok(grid.table.parent().is("div.k-grid-content"));
            });

            test("scrollable area is sized", function() {
            var grid = new Grid(table, { height: 100, pageable: { info: false, previousNext: false }, scrollable: true, dataSource: [{foo:"bar"}], columns: [{field:"foo", footerTemplate:"bar"}]});

                equal(grid.wrapper.find(".k-grid-content").height(), 100
                    - grid.wrapper.find(".k-grid-header").outerHeight()
                    - grid.wrapper.find(".k-grid-footer").outerHeight()
                    - grid.wrapper.find(".k-grid-pager").outerHeight());
            });

            test("grid height is applied to the wrapper element", function() {
                var grid = new Grid(table, { height: 100, dataSource: [{foo:"bar"}] });

                equal(grid.wrapper.height(), 100);
            });

            test("non-scrollable grid thead has k-grid-header class", function() {
                var grid = new Grid(table, { dataSource: [{foo:"bar"}], scrollable: false });

                ok(grid.thead.hasClass("k-grid-header"));
            });

            test("col elements are created for every column in non-scrollable grid", function() {
                var grid = new Grid(table, {
                    dataSource: [],
                    columns: [{field: "foo" }, {field: "bar"}],
                    scrollable: false
                });
                var headerTable = grid.thead.parent();

                ok(headerTable.find("colgroup").length);
                equal(headerTable.find("col").length, 2);
            });

            test("col elements are created for every column in scrollable grid", function() {
                var grid = new Grid(table, {
                    dataSource: [],
                    columns: [{field: "foo" }, {field: "bar"}],
                    scrollable: true
                });

                var colgroups = grid.wrapper.find("colgroup");

                equal(colgroups.length, 2);
                equal(colgroups.eq(0).find("col").length, 2);
                equal(colgroups.eq(1).find("col").length, 2);
            });

            test("hierarhcy col element is created in non-scrollable grid when table element has hierarchy col defined", function() {
                var grid = new Grid('<table><colgroup><col class="k-hierarchy-col"/></colgroup></table>', {
                    dataSource: [],
                    columns: [{field: "foo" }, {field: "bar"}],
                    scrollable: false
                });
                var headerTable = grid.thead.parent();

                equal(headerTable.find("colgroup").length, 1);
                equal(headerTable.find("col").length, 3);
                ok(headerTable.find("col").eq(0).hasClass("k-hierarchy-col"));
            });

            test("hierarhcy col element is created in scrollable grid when table element has hierarchy col defined", function() {
                var grid = new Grid('<table><colgroup><col class="k-hierarchy-col"/></colgroup></table>', {
                    dataSource: [],
                    columns: [{field: "foo" }, {field: "bar"}]
                });

                var colgroups = grid.wrapper.find("colgroup");

                equal(colgroups.length, 2);
                equal(colgroups.eq(0).find("col").length, 3);
                equal(colgroups.eq(1).find("col").length, 3);
                ok(colgroups.eq(0).find("col:first").hasClass("k-hierarchy-col"));
                ok(colgroups.eq(0).find("col:first").hasClass("k-hierarchy-col"));
            });

            test("column width is applied on col element", function() {
                var width = "200px",
                    grid = new Grid(table, {
                        dataSource: [],
                        columns: [{field: "foo", width: width }],
                        scrollable: true
                    });

                var cols = grid.wrapper.find("col");
                equal(cols.length, 2);
                equal(cols[0].style.width, width);
                equal(cols[1].style.width, width);
            });

            test("column width is parsed from DOM col element when grid created from table element", function() {
                var element = $('<table><colgroup><col style="width:200px"/><col /></colgroup><thead><th data-kendo-field="foo"></th><th data-kendo-field="bar"></th><th data-kendo-field="baz"></th></thead></table>'),
                    grid = new Grid(element, {
                        dataSource: [],
                        scrollable: false
                    });

                var cols = grid.wrapper.find("col");
                equal(cols.length, 3);
                equal(cols.eq(0).css("width"), "200px");
                equal(cols.eq(1).css("width"), "0px");
                equal(cols.eq(2).css("width"), "0px");
            });

            test("dataBound event is raised if bound to array", function() {
                var called = false,
                    grid = new Grid(table, {
                        dataSource: [ {foo:"foo", bar:"bar"} ],
                        dataBound: function() { called = true; }
                    });
                ok(called);
            });

            test("cancelling databinding event prevents refresh", function() {
                var grid = new Grid(table, {
                        dataSource: [ {foo:"foo", bar:"bar"} ],
                        dataBinding: function(e) { e.preventDefault(); }
                    });

                equal(grid.items().length, 0);
            });

            test("DataSource change action is passed to databinding event", 3, function() {
                var grid = new Grid(table, {
                        dataSource: [ {foo:"foo", bar:"bar"} ],
                    });

                grid.bind("dataBinding", function(e) {
                    equal(e.index, 1);
                    equal(e.action, "add");
                    equal(e.items.length, 1);
               });

               grid.dataSource.insert(1, {});
            });


            test("initialization from rendered table should disable encoding", function() {
                $(table).html("<thead><tr><th data-kendo-field='col1'>col1</th></tr></thead><tbody><tr><td>&nbsp;</td></tr></tbody>");
                var grid = new Grid(table, {scrollable: false});

                equal(grid.columns[0].encoded, false);
            });

            test("sortable columns", function() {
                $(table).html("<thead><tr><th data-kendo-field='col1'>col1</th></tr></thead><tbody><tr><td>&nbsp;</td></tr></tbody>");
                var grid = new Grid(table, {
                    sortable: true
                });

                ok(grid.thead.find("th").data("kendoSortable"), "Column is not sortable");
            });

            test("unsortable column from column settings", function() {
                $(table).html("<thead><tr><th data-kendo-field='col1'>col1</th></tr></thead><tbody><tr><td>&nbsp;</td></tr></tbody>");
                var grid = new Grid(table, {
                    sortable: true,
                    columns: [{
                        sortable: false
                    }]
                });

                equal(grid.thead.find("th").data("kendoSortable"), undefined, "Column is not sortable");
            });

            test("unsortable column from html attribute", function() {
                $(table).html("<thead><tr><th data-kendo-sortable=false data-kendo-field='col1'>col1</th></tr></thead><tbody><tr><td>&nbsp;</td></tr></tbody>");
                var grid = new Grid(table, {
                    sortable: true
                });

                ok(!(grid.thead.find("th").data("kendoSortable") instanceof kendo.ui.Sortable));
            });

            test("filterable columns", function() {
                $(table).html("<thead><tr><th data-kendo-field='col1'>col1</th></tr></thead><tbody><tr><td>&nbsp;</td></tr></tbody>");
                var grid = new Grid(table, {
                    filterable: true,
                    dataSource: {
                        schema: {
                            model: {
                                fields: {
                                    col1: {}
                                }
                            }
                        }
                    },
                });

                ok(grid.thead.find("th").data("kendoFilterMenu"));
            });

            test("column without field is not filterable", function() {
                var grid = new Grid(table, {
                    filterable: true,
                    columns: [{ title: "foo"}],
                    dataSource: {
                        schema: {
                            model: {
                                fields: {
                                    col1: {}
                                }
                            }
                        }
                    },
                });

                equal(grid.thead.find("th").data("kendoFilterMenu"), undefined, "Column is not filterable");
            });

            test("unfilterable column from column settings", function() {
                $(table).html("<thead><tr><th data-kendo-field='col1'>col1</th></tr></thead><tbody><tr><td>&nbsp;</td></tr></tbody>");
                var grid = new Grid(table, {
                    filterable: true,
                    columns: [{filterable: false}],
                    dataSource: {
                        schema: {
                            model: {
                                fields: {
                                    col1: {}
                                }
                            }
                        }
                    },
                });

                equal(grid.thead.find("th").data("kendoFilterMenu"), undefined, "Column is not filterable");
            });

            test("filter menu initialized event is raised", 1, function() {
                var grid = new Grid(table, {
                    filterable: true,
                    columns: [{ field: "foo"}],
                    filterMenuInit: function() { ok(true); }
                });

                grid.thead.find("th").data("kendoFilterMenu").link.click();
            });

            test("unfilterable column from html attribute", function() {
                $(table).html("<thead><tr><th data-kendo-filterable=false data-kendo-field='col1'>col1</th></tr></thead><tbody><tr><td>&nbsp;</td></tr></tbody>");
                var grid = new Grid(table, {
                    filterable: true,
                    dataSource: {
                        schema: {
                            model: {
                                fields: {
                                    col1: {}
                                }
                            }
                        }
                    },
                });

                equal(grid.thead.find("th").data("kendoFilterMenu"), undefined, "Column is not filterable");
            });

            test("filterable options are initialized", function() {
                $(table).html("<thead><tr><th data-kendo-field='col1'>col1</th></tr></thead><tbody><tr><td>&nbsp;</td></tr></tbody>");
                var grid = new Grid(table, {
                    filterable: {
                        extra: false
                    },
                    dataSource: {
                        schema: {
                            model: {
                                fields: {
                                    col1: {}
                                }
                            }
                        }
                    },
                });

                equal(grid.thead.find("th").data("kendoFilterMenu").options.extra, false);
            });

            test("filterable options are initialized from column settings", function() {
                $(table).html("<thead><tr><th data-kendo-field='col1'>col1</th></tr></thead><tbody><tr><td>&nbsp;</td></tr></tbody>");
                var grid = new Grid(table, {
                    filterable: true,
                    columns: [{ filterable: { extra: false }}],
                    dataSource: {
                        schema: {
                            model: {
                                fields: {
                                    col1: {}
                                }
                            }
                        }
                    },
                });

                equal(grid.thead.find("th").data("kendoFilterMenu").options.extra, false);
            });

            test("column values are passed to the filterable", function() {
                $(table).html("<thead><tr><th data-kendo-field='col1'>col1</th></tr></thead><tbody><tr><td>&nbsp;</td></tr></tbody>");
                var grid = new Grid(table, {
                    filterable: true,
                    columns: [{ values: [{ text: "foo", value: 0 }]}],
                    dataSource: {
                        schema: {
                            model: {
                                fields: {
                                    col1: {}
                                }
                            }
                        }
                    },
                });

                equal(grid.thead.find("th").data("kendoFilterMenu").options.values.length, 1);
            });

            test("detail th is created when thead is defined", function() {
                var grid = new Grid($('<table><th data-kendo-field="foo"></th></table>')[0], {
                        dataSource: [],
                        detailInit: $.noop }),
                    th = grid.thead.find("th");

                equal(th.length, 2);
                ok(th.eq(0).hasClass("k-hierarchy-cell"));
            });

            test("render column attribute", function() {
                var grid = new Grid($("<table/>"), {
                    dataSource: [{ foo: 1, bar: "bar"}],
                    columns: [
                        { field: "foo", attributes: { baz: "baz1" } },
                        { field: "bar", attributes: { moo: "moo1" } }
                    ]
                });

                equal(grid.tbody.find("tr:first > td:first").attr("baz"), "baz1");
                equal(grid.tbody.find("tr:first > td:last").attr("moo"), "moo1");
            });

            test("render command column attribute", function() {
                var grid = new Grid($("<table/>"), {
                    dataSource: [{ foo: 1, bar: "bar"}],
                    columns: [
                        { command: "foo", attributes: { baz: "baz1" } },
                        { command: "bar", attributes: { moo: "moo1" } }
                    ]
                });

                equal(grid.tbody.find("tr:first > td:first").attr("baz"), "baz1");
                equal(grid.tbody.find("tr:first > td:last").attr("moo"), "moo1");
            });

            test("render command button attributes as string", function() {
                var grid = new Grid($("<table/>"), {
                    dataSource: [{ foo: 1, bar: "bar"}],
                    columns: [ { command: { name: "foo", attr: "baz=baz1"  } } ]
                });

                equal(grid.tbody.find("tr:first > td:first a").attr("baz"), "baz1");
            });

            test("render command button attributes as object", function() {
                var grid = new Grid($("<table/>"), {
                    dataSource: [{ foo: 1, bar: "bar"}],
                    columns: [ { command: { name: "foo", attr: { baz: "baz1" }  } } ]
                });

                equal(grid.tbody.find("tr:first > td:first a").attr("baz"), "baz1");
            });

            test("render column header attribute", function() {
                var grid = new Grid($("<table/>"), {
                    dataSource: [{ foo: 1, bar: "bar"}],
                    columns: [
                        { field: "foo", headerAttributes: { baz: "baz1" } },
                        { field: "bar", headerAttributes: { moo: "moo1" } }
                    ]
                });

                equal(grid.thead.find("th:first").attr("baz"), "baz1");
                equal(grid.thead.find("th:last").attr("moo"), "moo1");
            });

            test("render command column header attribute", function() {
                var grid = new Grid($("<table/>"), {
                    dataSource: [{ foo: 1, bar: "bar"}],
                    columns: [
                        { command: "foo", headerAttributes: { baz: "baz1" } },
                        { command: "bar", headerAttributes: { moo: "moo1" } }
                    ]
                });

                equal(grid.thead.find("th:first").attr("baz"), "baz1");
                equal(grid.thead.find("th:last").attr("moo"), "moo1");
            });

            test("render column footer attribute", function() {
                var grid = new Grid($("<table/>"), {
                    dataSource: [{ foo: 1, bar: "bar"}],
                    columns: [
                        { field: "foo", footerAttributes: { baz: "baz1" }, footerTemplate: "foo" },
                        { field: "bar", footerAttributes: { moo: "moo1" }, footerTemplate: "bar" }
                    ]
                });

                equal(grid.footer.find("td:first").attr("baz"), "baz1");
                equal(grid.footer.find("td:last").attr("moo"), "moo1");
            });

            test("render command column footer attribute", function() {
                var grid = new Grid($("<table/>"), {
                    dataSource: [{ foo: 1, bar: "bar"}],
                    columns: [
                        { field: "foo", footerAttributes: { baz: "baz1" }, footerTemplate: "foo" },
                        { command: "bar", footerAttributes: { moo: "moo1" }, footerTemplate: "bar" }
                    ]
                });

                equal(grid.footer.find("td:first").attr("baz"), "baz1");
                equal(grid.footer.find("td:last").attr("moo"), "moo1");
            });

            test("css class is added to custom command button", function() {
                var grid = new Grid($("<table/>"), {
                    dataSource: [{ foo: 1, bar: "bar"}],
                    columns: [ { command: "bar" }]
                });

                ok(grid.tbody.find("tr:first > td:first a").hasClass("k-grid-bar"));
            });

            test("both service and custom css classes are added to custom command button", function() {
                var grid = new Grid($("<table/>"), {
                    dataSource: [{ foo: 1, bar: "bar"}],
                    columns: [ { command: { className: "bar", name: "foo" } }]
                });

                var button = grid.tbody.find("tr:first > td:first a");
                ok(button.hasClass("k-grid-foo"));
                ok(button.hasClass("bar"));
            });

            test("text is used if no name is set", function() {
                var grid = new Grid($("<table/>"), {
                    dataSource: [{ foo: 1, bar: "bar"}],
                    columns: [ { command: { text: "bar"} }]
                });

                ok(grid.tbody.find("tr:first > td:first a").hasClass("k-grid-bar"));
            });

            test("spaces are removed from the text when used as class", function() {
                var grid = new Grid($("<table/>"), {
                    dataSource: [{ foo: 1, bar: "bar"}],
                    columns: [ { command: { text: "bar baz"} }]
                });

                ok(grid.tbody.find("tr:first > td:first a").hasClass("k-grid-barbaz"));
            });

            test("custom command without name throws error", function() {
                raises(function() {
                    var grid = new Grid($("<table/>"), {
                        dataSource: [{ foo: 1, bar: "bar"}],
                        columns: [{ command: { className: "foo" } }]
                    });
                },
                function(error) {
                    return error.message === "Custom commands should have name specified";
                });
            });

            test("custom command click handler is called if only text with multiple spaces is set", 1, function() {
                var grid = new Grid($("<table/>"), {
                    dataSource: [{ foo: 1, bar: "bar"}],
                    columns: [
                    {
                        command: {
                            text: "bar baz boo",
                            click: function() {
                                ok(true);
                            }
                        }
                    }]
                });
                grid.items().first().find("td:first a").click();
            });

            test("custom command click handler is called", 1, function() {
                var grid = new Grid($("<table/>"), {
                    dataSource: [{ foo: 1, bar: "bar"}],
                    columns: [
                    {
                        command: {
                            name: "bar",
                            click: function() {
                                ok(true);
                            }
                        }
                    }]
                });
                grid.items().first().find("td:first a").click();
            });

            test("custom command click handler is called if multiple commands", 1, function() {
                var grid = new Grid($("<table/>"), {
                    dataSource: [{ foo: 1, bar: "bar"}],
                    columns: [
                    {
                        command: [{
                            name: "bar",
                            click: function() {
                                ok(true);
                            }
                        }, "othercommand"]
                    }]
                });
                grid.items().first().find("td:first a:first").click();
                grid.items().first().find("td:first a:last").click();
            });

            test("command name is passed to custom command click handler", 1, function() {
                var grid = new Grid($("<table/>"), {
                    dataSource: [{ foo: 1, bar: "bar"}],
                    columns: [
                    {
                        command: [{
                            name: "bar",
                            click: function(e) {
                                equal(e.data.commandName, "bar");
                            }
                        }]
                    }]
                });
                grid.items().first().find("td:first a:first").click();
            });

            test("grid instance is the context for the custom command handler", 1, function() {
                var grid = new Grid($("<table/>"), {
                    dataSource: [{ foo: 1, bar: "bar"}],
                    columns: [
                    {
                        command: [{
                            name: "bar",
                            click: function(e) {
                                same(this, grid);
                            }
                        }]
                    }]
                });
                grid.items().first().find("td:first a:first").click();
            });

            test("render column header template", function() {
                var grid = new Grid($("<table/>"), {
                    dataSource: [{ foo: 1, bar: "bar"}],
                    columns: [ { field: "foo", headerTemplate: "custom text" } ]
                });
                equal(grid.thead.find("tr:first > th:first").text(), "custom text");
            });

            test("column header template as function", function() {
                var grid = new Grid($("<table/>"), {
                    dataSource: [{ foo: 1, bar: "bar"}],
                    columns: [ { field: "foo", headerTemplate: function() { return "custom text" } } ]
                });
                equal(grid.thead.find("tr:first > th:first").text(), "custom text");
            });

            test("render command column header template", function() {
                var grid = new Grid($("<table/>"), {
                    dataSource: [{ foo: 1, bar: "bar"}],
                    columns: [ { command: "foo", headerTemplate: "custom text" } ]
                });
                equal(grid.thead.find("tr:first > th:first").text(), "custom text");
            });

            test("column displays value from values", function() {
                var grid = new Grid($("<table/>"), {
                    dataSource: [{ foo: 1, bar: "bar"}],
                    columns: [ { field: "foo", values: [ { value: 0, text: "custom text" }, { value: 1, text: "custom text1" },{ value: 2, text: "custom text2" }] } ]
                });

                equal(grid.items().first().find("td:first").text(), "custom text1");
            });

            test("column does not display value from values if value field is not defined", function() {
                var grid = new Grid($("<table/>"), {
                    dataSource: [{ foo: 1, bar: "bar"}],
                    columns: [ { field: "foo", values: [ "custom text" ] } ]
                });

                equal(grid.items().first().find("td:first").text(), "1");
            });

            test("hidden column does not render cols", function() {
                var grid = new Grid($("<table/>"), {
                    dataSource: [{ foo: 1, bar: "bar"}],
                    columns: [
                        { field: "foo", hidden: true },
                        { field: "bar" }
                    ]
                });

                equal(grid.thead.prev().find("col").length, 1);
                equal(grid.tbody.prev().find("col").length, 1);
            });

            test("hidden column set hidden attribute for header cell", function() {
                var grid = new Grid($("<table/>"), {
                    dataSource: [{ foo: 1, bar: "bar"}],
                    columns: [
                        { field: "foo", hidden: true },
                        { field: "bar" }
                    ]
                });

                equal(grid.columns[0].headerAttributes.style, "display:none");
            });

            test("hidden column set hidden attribute for footer cell", function() {
                var grid = new Grid($("<table/>"), {
                    dataSource: [{ foo: 1, bar: "bar"}],
                    columns: [
                        { field: "foo", hidden: true, footerTemplate: "foo" },
                        { field: "bar" }
                    ]
                });

                equal(grid.columns[0].footerAttributes.style, "display:none");
            });

            test("hidden columns set hidden attribute for data cell", function() {
                var grid = new Grid($("<table/>"), {
                    dataSource: [{ foo: 1, bar: "bar"}],
                    columns: [
                        { field: "foo", hidden: true },
                        { field: "bar" }
                    ]
                });

                equal(grid.columns[0].attributes.style, "display:none");
            });

            test("detail cell colspan depends on visible columns", function() {
                var grid = new Grid($("<table/>"), {
                    dataSource: [{ foo: 1, bar: "bar"}],
                    detailTemplate: "foo",
                    columns: [
                        { field: "foo", hidden: true },
                        { field: "bar" }
                    ]
                });

                grid.expandRow(grid.items()[0]);

                equal(grid.tbody.find(".k-detail-row>.k-detail-cell").attr("colspan"), "1");
            });

            test("group cell colspan depends on visible columns", function() {
                var grid = new Grid($("<table/>"), {
                    dataSource: {
                        data: [{ foo: 1, bar: "bar"}],
                        group: { field: "foo" }
                    },
                    columns: [
                        { field: "foo", hidden: true },
                        { field: "bar" }
                    ]
                });

                grid.expandRow(grid.items()[0]);

                equal(grid.tbody.find(".k-grouping-row>td").attr("colspan"), "2");
            });
        </script>
        <div id="qunit-fixture">test markup, will be hidden</div>
        <ul id="log"></ul>
    </body>
</html>
