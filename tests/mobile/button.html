<!DOCTYPE dom>
<html>
    <head>
        <title>kendo.ui.MobileButton Tests</title>
        <script src="../../src/jquery.js"></script>
        <script src="../qunit/qunit/qunit.js"></script>
        <script src="../qunit-runner.js"></script>
        <script src="../../src/kendo.core.js"></script>
        <script src="../../src/kendo.data.js"></script>
        <script src="../../src/kendo.binder.js"></script>
        <script src="../../src/kendo.fx.js"></script>
        <script src="../../src/kendo.mobile.button.js"></script>
        <link rel="stylesheet" href="../qunit/qunit/qunit.css" />
    </head>
    <body>
        <h1 id="qunit-header">kendo.mobile.ui.Button Tests</h1>
        <h2 id="qunit-banner"></h2>
        <div id="qunit-testrunner-toolbar"></div>
        <h2 id="qunit-userAgent"></h2>
        <ol id="qunit-tests"></ol>
        <div id="qunit-fixture">test markup, will be hidden</div>
        <ul id="log"></ul>

        <script>

            var Button = kendo.mobile.ui.Button,
                MOUSEDOWN = kendo.support.mousedown,
                MOUSEUP = kendo.support.mouseup;

            function click(dom) {
                dom.trigger(MOUSEDOWN);
                dom.trigger(MOUSEUP);
            }

            module("mobile button", {
                // setup: function() { kendo.ns = "kendo-"; }
            });


            test("applies css class", function() {
                expect(1);

                var dom = $("<button/>");

                var button = new Button(dom);

                ok(button.element.hasClass("km-button"), "has specified CSS class");
            });

            test("accepts css class through options", function() {
                var dom = $('<button data-role="button" data-style="detail"/>');

                kendo.mobile.init(dom);

                ok(dom.hasClass("km-detail"), "has specified CSS class");
            });

            test("wraps content in a span", function() {
                var dom = $("<button>foo</button>");

                var button = new Button(dom);

                ok(button.element.children().first().is("span.km-text"), "Should wrap contents");
            });

            test("reuses existing span", function() {
                var dom = $("<button><span>foo</span></button>");
                var span = dom.find("span");

                var button = new Button(dom);

                ok(span.hasClass("km-text"), "Should wrap contents");
            });

            test("adds css class to children img elements", function() {
                var dom = $("<button><img/>foo</button>");
                var img = dom.find("img");

                var button = new Button(dom);

                ok(img.hasClass("km-image"), "Should set css class to img");
            });

            asyncTest("raises click event when clicked", 1, function() {
                var dom = $("<button>foo</button>");

                var button = new Button(dom);

                button.bind("click", function() {
                    start();
                    ok(true, "Should raise the click event");
                });

                click(dom);
            });

            test("Sets active css class on 'down'", 1, function() {
                var dom = $("<button>foo</button>");

                var button = new Button(dom);

                dom.trigger(MOUSEDOWN);

                ok(dom.hasClass("km-state-active"), "Should set the active class");
            });

            test("icon only button", function() {
                var dom = $('<button data-role="button" data-icon="history"></button>');
                kendo.mobile.init(dom);

                ok(!dom.find("span.km-text")[0]);
                ok(dom.find("span.km-icon").hasClass("km-notext"));
            });

            test("binding visible to false hides the widget", function() {
                var dom = $('<button data-role="button" data-icon="history" data-bind="visible:visible"></button>');

                var observable = kendo.observable({
                    visible: false
                });

                kendo.bind(dom, observable, kendo.mobile.ui);

                ok(dom.data("kendoMobileButton").wrapper.css("display") == "none", "Display is 'none'");
            });

            test("binding visible to true shows the widget", function() {
                var dom = $('<button data-role="button" data-icon="history" style="display:none" data-bind="visible:visible"></button>');

                var observable = kendo.observable({
                    visible: true
                });

                kendo.bind(dom, observable, kendo.mobile.ui);

                ok(dom.data("kendoMobileButton").wrapper.css("display") != "none", "Display is not 'none'");
            });

            test("changing visible to false hides the widget", function() {
                var dom = $('<button data-role="button" data-icon="history" data-bind="visible:visible"></button>');

                var observable = kendo.observable({
                    visible: true
                });

                kendo.bind(dom, observable, kendo.mobile.ui);
                observable.set("visible", false);

                ok(dom.data("kendoMobileButton").wrapper.css("display") == "none", "Display is 'none'");
            });

            test("changing visible to true shows the widget", function() {
                var dom = $('<button data-role="button" data-icon="history" data-bind="visible:visible"></button>');

                var observable = kendo.observable({
                    visible: false
                });

                kendo.bind(dom, observable, kendo.mobile.ui);
                observable.set("visible", true);

                ok(dom.data("kendoMobileButton").wrapper.css("display") != "none", "Display is not 'none'");
            });

            test("binding invisible to true hides the widget", function() {
                var dom = $('<button data-role="button" data-icon="history" data-bind="invisible:invisible"></button>');

                var observable = kendo.observable({
                    invisible: true
                });

                kendo.bind(dom, observable, kendo.mobile.ui);

                ok(dom.data("kendoMobileButton").wrapper.css("display") == "none", "display is 'none'");
            });

            test("binding invisible to false shows the widget", function() {
                var dom = $('<button data-role="button" data-icon="history" data-bind="invisible:invisible" style="display:none"></button>');

                var observable = kendo.observable({
                    invisible: false
                });

                kendo.bind(dom, observable, kendo.mobile.ui);

                ok(dom.data("kendoMobileButton").wrapper.css("display") != "none", "display is not 'none'");
            });

            test("changing invisible to true hides the widget", function() {
                var dom = $('<button data-role="button" data-icon="history" data-bind="invisible:invisible"></button>');

                var observable = kendo.observable({
                    invisible: false
                });

                kendo.bind(dom, observable, kendo.mobile.ui);
                observable.set("invisible", true);

                ok(dom.data("kendoMobileButton").wrapper.css("display") == "none", "display is 'none'");
            });

            test("changing invisible to false shows the widget", function() {
                var dom = $('<button data-role="button" data-icon="history" data-bind="invisible:invisible"></button>');

                var observable = kendo.observable({
                    invisible: true
                });

                kendo.bind(dom, observable, kendo.mobile.ui);
                observable.set("invisible", false);

                ok(dom.data("kendoMobileButton").wrapper.css("display") != "none", "display is not 'none'");
            });
        </script>
    </body>
</html>
