
<!DOCTYPE dom>
<html>
    <head>
        <meta http-equiv="content-type" content="text/html; charset=utf-8">
        <title>kendo.ui.MobileTabstrip Tests</title>
        <script src="../../src/jquery.js"></script>
        <script src="../qunit/qunit/qunit.js"></script>
        <script src="../qunit-runner.js"></script>
        <script src="../../src/kendo.core.js"></script>
        <script src="../../src/kendo.fx.js"></script>
        <script src="../../src/kendo.data.js"></script>
        <script src="../../src/kendo.mobile.loader.js"></script>
        <script src="../../src/kendo.mobile.tabstrip.js"></script>
        <link rel="stylesheet" href="../qunit/qunit/qunit.css" />
    </head>
    <body>
        <h1 id="qunit-header">kendo.mobile.ui.Tabstrip Tests</h1>
        <h2 id="qunit-banner"></h2>
        <div id="qunit-testrunner-toolbar"></div>
        <h2 id="qunit-userAgent"></h2>
        <ol id="qunit-tests"></ol>
        <div id="qunit-fixture">test markup, will be hidden</div>
        <ul id="log"></ul>

        <script>
            var Tabstrip = kendo.mobile.ui.TabStrip,
                dom,
                tabstrip;

            function click(dom) {
                dom.trigger("mousedown");
                dom.trigger("mouseup");
                dom.trigger("click");
            }

            module("mobile tabstrip", {
                setup: function() {
                    kendo.application = {};
                    stub(kendo.application, "navigate");
                    dom = $('<nav> \
                            <a href="foo" id="foo">foo</a> \
                            <a href="#bar" id="bar" data-icon="genius">bar</a> \
                            <a href="baz" id="baz"><img  />bar</a> \
                        </nav>');
                    tabstrip = new Tabstrip(dom);
                },

                teardown: function() {

                }
            });

            test("name is Tabstrip", function() {
                equal(Tabstrip.fn.options.name, "TabStrip", "Name is properly set");
            });

            test("creates html structure", function() {
                ok(dom.find("a>.km-text")[0], "text span is created");
                ok(dom.find("a>.km-icon")[0], "icon span is created");
            });

            test("raises select event when clicked", function() {
                expect(2);
                var button = dom.find("#bar");

                tabstrip.bind("select", function(e) {
                    ok(true, "raises the select event");
                    equal(e.item[0], button[0], "passes the clicked item in the event");
                });

                click(button);
            });

            test("marks first button as active by default", function() {
                ok(dom.find("#foo").is(".km-state-active"));
            });

            test("marks current button as active", function() {
                var button = dom.find("#bar").eq(0);
                click(button);
                ok(button.is(".km-state-active"));
            });

            test("removes previous button active state", function() {
                var button = dom.find("#foo");
                click(button);
                click($("#bar", dom));
                ok(!button.is(".km-state-active"));
            });

            test("allows user selection by index", function() {
                dom = $('<nav><a href="foo" id="foo">foo</a><a href="bar" id="bar">bar</a></nav>');
                tabstrip = new Tabstrip(dom, {selectedIndex: 1});
                ok(dom.find("#bar").is(".km-state-active"));
            });

            test("applies icon class if data attribute provided", function() {
                ok(dom.find("#bar span:first-child").is(".km-genius"), "bar tab has km-tab-icon-genius class");
            });

            test("applies image class on image if present", function() {
                ok(dom.find("#baz img").is(".km-image"), "baz tab img has km-image class");
                ok(!dom.find("#baz").find(".km-icon")[0], "baz does not create icon span");
            });

            test("ignores repeated clicks on the same button", function() {
                var button = dom.find("#foo");

                tabstrip.bind("select", function() {
                    ok(false, "select event is not called");
                });

                click(button);
                ok(button.is(".km-state-active"), "button is active");
            });

            test("switches to the button with the given url", function() {
                tabstrip.switchTo("bar");
                ok(dom.find("#bar").is(".km-state-active"), "button is active");
                ok(!dom.find("#foo").is(".km-state-active"), "previous button is not active");
            });

            test("switches to the button with the anchor url", function() {
                tabstrip.switchTo("#bar");
                ok(dom.find("#bar").is(".km-state-active"), "button is active");
            });

            test("does not deselect current button if non-existent url", function() {
                tabstrip.switchTo("#none");
                ok(dom.find("#foo").is(".km-state-active"), "button is active");
            });
        </script>
    </body>
</html>

