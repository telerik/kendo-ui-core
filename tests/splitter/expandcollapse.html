<!DOCTYPE html>
<html>
    <head>
        <title>Splitter collapse</title>
        <script src="../../src/jquery.js"></script>
        <script src="../qunit/qunit/qunit.js"></script>
        <script src="../qunit-runner.js"></script>
        <script src="../../src/kendo.core.js"></script>
        <script src="../../src/kendo.userevents.js"></script>
        <script src="../../src/kendo.draganddrop.js"></script>
        <script src="../../src/kendo.resizable.js"></script>
        <script src="../../src/kendo.splitter.js"></script>
        <script src="../jquery.mockjax.js"></script>
        <script src="helper.js"></script>
        <link rel="stylesheet" href="../qunit/qunit/qunit.css" />
        <link rel="stylesheet" href="../../styles/web/kendo.common.css" />
    </head>
    <body>
        <h1 id="qunit-header">Splitter collapse</h1>
        <h2 id="qunit-banner"></h2>
        <div id="qunit-testrunner-toolbar"></div>
        <h2 id="qunit-userAgent"></h2>
        <ol id="qunit-tests"></ol>
        <script>

            module("Splitter / Collapse", {
                teardown: function() {
                    $(".k-splitter").remove();
                }
            });

            test("clicking collapse arrow triggers collapse event", function() {
                var triggered = false,
                    splitter = $(getSplitterHtml())
                        .appendTo(document.body)
                        .kendoSplitter({
                            panes: [ { collapsible: true }, {} ],
                            collapse: function(e) {
                                triggered = e;
                            }
                        });

                splitter.find(".k-collapse-prev").trigger("click");

                ok(triggered);
                equals(triggered.pane, splitter.find(".k-pane:first")[0]);
            });

            test("collapse event can be prevented", function() {
                var splitter = $(getSplitterHtml())
                        .appendTo(document.body)
                        .kendoSplitter({
                            panes: [ { collapsible: true }, {} ],
                            collapse: function(e) {
                                e.preventDefault();
                            }
                        });

                splitter.find(".k-collapse-prev").trigger("click");

                ok(!splitter.find(".k-pane:first").data("pane").collapsed);
            });

            test("clicking collapse arrow calls splitter.collapse", function() {
                var called,
                    splitter = $(getSplitterHtml())
                        .appendTo(document.body)
                        .kendoSplitter({
                            panes: [ { collapsible: true }, {} ]
                        });

                splitter.data("kendoSplitter").collapse = function(pane) {
                    called = pane;
                }

                splitter.find(".k-collapse-prev").trigger("click");

                equals(called, splitter.find(".k-pane:first")[0]);
            });

            test("double-clicking splitbar next to an expanded collapsible pane should call splitter.collapse", function() {
                var called,
                    splitter = $(getSplitterHtml())
                        .appendTo(document.body)
                        .kendoSplitter({
                            panes: [ { collapsible: true }, {} ]
                        });

                splitter.data("kendoSplitter").collapse = function(pane) {
                    called = pane;
                }

                splitter.find(".k-splitbar").trigger("dblclick");

                equals(called, splitter.find(".k-pane:first")[0]);
            });

            test("double-clicking splitbar prev to an expanded collapsible pane should call splitter.collapse", function() {
                var called,
                    splitter = $(getSplitterHtml())
                        .appendTo(document.body)
                        .kendoSplitter({
                            panes: [ {}, { collapsible: true } ]
                        });

                splitter.data("kendoSplitter").collapse = function(pane) {
                    called = pane;
                }

                splitter.find(".k-splitbar").trigger("dblclick");

                equals(called, splitter.find(".k-pane:last")[0]);
            });


            module("Splitter / Expand", {
                teardown: function() {
                    $(".k-splitter").remove();
                }
            });

            test("clicking expand arrow triggers expand event", function() {
                var triggered = false,
                    splitter = $(getSplitterHtml())
                        .appendTo(document.body)
                        .kendoSplitter({
                            panes: [ { collapsible: true, collapsed: true }, {} ],
                            expand: function(e) {
                                triggered = e;
                            }
                        });

                splitter.find(".k-expand-prev").trigger("click");

                ok(triggered);
                equals(triggered.pane, splitter.find(".k-pane:first")[0]);
            });

            test("expand event can be prevented", function() {
                var splitter = $(getSplitterHtml())
                    .appendTo(document.body)
                    .kendoSplitter({
                        panes: [ { collapsible: true, collapsed: true }, {} ],
                        expand: function(e) {
                            e.preventDefault();
                        }
                    });

                splitter.find(".k-expand-prev").trigger("click");

                ok(splitter.find(".k-pane:first").data("pane").collapsed);
            });

            test("clicking expand arrow calls splitter.expand", function() {
                var called,
                    splitter = $(getSplitterHtml())
                        .appendTo(document.body)
                        .kendoSplitter({
                            panes: [ { collapsible: true, collapsed: true }, {} ]
                        });

                splitter.data("kendoSplitter").expand = function(pane) {
                    called = pane;
                }

                splitter.find(".k-expand-prev").trigger("click");

                equals(called, splitter.find(".k-pane:first")[0]);
            });

            test("double-clicking splitbar next to an collapsed collapsible pane should call splitter.collapse", function() {
                var called,
                    splitter = $(getSplitterHtml())
                        .appendTo(document.body)
                        .kendoSplitter({
                            panes: [ { collapsible: true, collapsed: true }, {} ]
                        });

                splitter.data("kendoSplitter").expand = function(pane) {
                    called = pane;
                }

                splitter.find(".k-splitbar").trigger("dblclick");

                equals(called, splitter.find(".k-pane:first")[0]);
            });

            test("double-clicking splitbar prev to an collapsed collapsible pane should call splitter.collapse", function() {
                var called,
                    splitter = $(getSplitterHtml())
                        .appendTo(document.body)
                        .kendoSplitter({
                            panes: [ { }, { collapsible: true, collapsed: true } ]
                        });

                splitter.data("kendoSplitter").expand = function(pane) {
                    called = pane;
                }

                splitter.find(".k-splitbar").trigger("dblclick");

                equals(called, splitter.find(".k-pane:last")[0]);
            });

            test("double-clicking splitbar between two collapsible panes does not trigger collapse", function() {
                var called,
                    splitter = $(getSplitterHtml())
                        .appendTo(document.body)
                        .kendoSplitter({
                            panes: [ { collapsible: true }, { collapsible: true } ]
                        });

                splitter.data("kendoSplitter").collapse = function(pane) {
                    called = pane;
                }

                splitter.find(".k-splitbar").trigger("dblclick");

                ok(!called);
            });

            test("expanding a non-resizable pane does not make it resizable", function() {
                var splitter = $(getSplitterHtml())
                        .appendTo(document.body)
                        .kendoSplitter({
                            panes: [
                                { resizable: false, collapsible: true, collapsed: true },
                                { collapsible: false }
                            ]
                        });

                splitter.data("kendoSplitter").expand(".k-pane:first");

                ok(splitter.find(".k-splitbar").is(":not(.k-splitbar-draggable-horizontal)"))
            });

            test("expanding a non-resizable pane does not modify more splitbars than necessary", function() {
                var splitter = $(getSplitterHtml(3))
                        .appendTo(document.body)
                        .kendoSplitter({
                            panes: [
                                { resizable: false, collapsible: true, collapsed: true },
                                { collapsible: false },
                                { collapsible: false }
                            ]
                        });

                splitter.data("kendoSplitter").expand(".k-pane:first");

                ok(splitter.find(".k-splitbar:first").is(":not(.k-splitbar-draggable-horizontal)"));
                ok(splitter.find(".k-splitbar:last").is(".k-splitbar-draggable-horizontal"));
            });

            test("initially collapsed pane has an overflow:hidden style", function() {
                var splitter = $(getSplitterHtml(3))
                        .appendTo(document.body)
                        .kendoSplitter({
                            panes: [
                                { collapsed: true },
                                { collapsed: false },
                                { collapsed: false }
                            ]
                        });

                equal(splitter.find(".k-pane:first").css("overflow"), "hidden");
            });

            test("expanding a previously collapsed pane removes its overflow:hidden style", function() {
                var splitter = $(getSplitterHtml(3))
                        .appendTo(document.body)
                        .kendoSplitter({
                            panes: [
                                { collapsed: false },
                                { collapsed: false },
                                { collapsed: false }
                            ]
                        });

                splitter.data("kendoSplitter").collapse(".k-pane:first");
                splitter.data("kendoSplitter").expand(".k-pane:first");

                equal(splitter.find(".k-pane:first").css("overflow"), "auto");
            });

            test("collapsing pane disables collapsing of next pane", function() {
                var splitter = $(getSplitterHtml(2))
                        .appendTo(document.body)
                        .kendoSplitter({
                            panes: [ { collapsible: true }, { collapsible: true } ]
                        });

                splitter.data("kendoSplitter").collapse(".k-pane:first");

                ok(splitter.find(".k-splitbar").is(":not(.k-splitbar-draggable-horizontal)"));
                ok(!splitter.find(".k-splitbar .k-collapse-next").length);
            });

            test("collapsing pane disables collapsing of previous pane", function() {
                var splitter = $(getSplitterHtml(2))
                        .appendTo(document.body)
                        .kendoSplitter({
                            panes: [ { collapsible: true }, { collapsible: true } ]
                        });

                splitter.data("kendoSplitter").collapse(".k-pane:last");

                ok(splitter.find(".k-splitbar").is(":not(.k-splitbar-draggable-horizontal)"));
                ok(!splitter.find(".k-splitbar .k-collapse-prev").length);
            });

            test("collapsing the last fluid pane distributes remaining size to neighbour pane", function() {
                var splitter = $(getSplitterHtml(2))
                        .appendTo(document.body)
                        .kendoSplitter({
                            panes: [
                                { collapsible: true, size: "50px" },
                                { collapsible: true }
                            ]
                        });

                splitter.data("kendoSplitter").collapse(".k-pane:last");

                equal(splitter.find(".k-pane:first").width(), splitter.width() - 7);
                equal(splitter.find(".k-splitbar:first")[0].offsetLeft, splitter.width() - 7);
            });

            test("collapsing the last fluid pane in vertical splitter distributes remaining size to neighbour pane", function() {
                var splitter = $(getSplitterHtml(2))
                        .appendTo(document.body)
                        .kendoSplitter({
                            orientation: "vertical",
                            panes: [
                                { collapsible: true, size: "50px" },
                                { collapsible: true }
                            ]
                        });

                splitter.data("kendoSplitter").collapse(".k-pane:last");

                equal(splitter.find(".k-pane:first").height(), splitter.height() - 7);
                equal(splitter.find(".k-splitbar:first")[0].offsetTop, splitter.height() - 7);
            });

            test("collapsing a pane adds an overflow:hidden style to it", function() {
                var splitter = $(getSplitterHtml(2))
                        .appendTo(document.body)
                        .kendoSplitter({
                            panes: [
                                { collapsible: true },
                                { collapsible: true }
                            ]
                        });

                splitter.data("kendoSplitter").collapse(".k-pane:first");

                equal(splitter.find(".k-pane:first").css("overflow"), "hidden");
            });

            test("collapsing pane does not add overlay to frames", function() {
                $.mockjax({
                    url: "http://foo",
                    responseText: "foo"
                });

                var splitter = $(getSplitterHtml(2))
                        .appendTo(document.body)
                        .kendoSplitter({
                            panes: [
                                { collapsible: true },
                                { contentUrl: "http://foo" }
                            ]
                        });

                splitter.find(".k-collapse-prev")
                    .trigger("mousedown")
                    .trigger("mouseup")
                    .trigger("click");

                equal(splitter.find(".k-overlay").length, 0);
            });
        </script>
        <div id="qunit-fixture">test markup, will be hidden</div>
        <ul id="log"></ul>
    </body>
</html>
