<!DOCTYPE html>
<html>
    <head>
        <title>Splitter client API</title>
        <script src="../../src/jquery.js"></script>
        <script src="../qunit/qunit/qunit.js"></script>
        <script src="../qunit-runner.js"></script>
        <script src="../../src/kendo.core.js"></script>
        <script src="../../src/kendo.userevents.js"></script>
        <script src="../../src/kendo.draganddrop.js"></script>
        <script src="../../src/kendo.resizable.js"></script>
        <script src="../../src/kendo.splitter.js"></script>
        <script src="helper.js"></script>
        <link rel="stylesheet" href="../qunit/qunit/qunit.css" />
    </head>
    <body>
        <h1 id="qunit-header">Splitter client API</h1>
        <h2 id="qunit-banner"></h2>
        <div id="qunit-testrunner-toolbar"></div>
        <h2 id="qunit-userAgent"></h2>
        <ol id="qunit-tests"></ol>
        <script>

            module("Splitter / ClientSideApi", {
                teardown: function() {
                    $('.k-splitter').remove();
                }
            });

            test("toggle(false) toggles pane state", function() {
                var splitter = $(getSplitterHtml())
                        .appendTo(document.body)
                        .kendoSplitter({
                            panes: [ { collapsible: true }, {} ]
                        }),
                    pane = splitter.find(".k-pane:first");

                splitter.data("kendoSplitter").toggle(pane, false);

                ok(pane.data("pane").collapsed);

                splitter = $(getSplitterHtml())
                    .appendTo(document.body)
                    .kendoSplitter({
                        panes: [ {}, { collapsible: true } ]
                    });

                pane = splitter.find(".k-pane:last")

                splitter.data("kendoSplitter").toggle(pane, false);

                ok(pane.data("pane").collapsed);
            });

            test("toggle(false) triggers resize", function() {
                var triggered = false,
                    splitter = $(getSplitterHtml())
                        .appendTo(document.body)
                        .kendoSplitter({
                            panes: [ { collapsible: true }, {} ],
                            resize: function() {
                                triggered = true;
                            }
                        });

                splitter.data("kendoSplitter").toggle(".k-pane:last", false);

                ok(triggered);
            });

            test("toggle(false) converts associated arrow to expand arrow", function() {
                var splitter = $(getSplitterHtml())
                        .appendTo(document.body)
                        .kendoSplitter({
                            panes: [ { collapsible: true }, {} ]
                        });

                splitter.data("kendoSplitter").toggle(".k-pane:first", false);

                var previousArrow = splitter.find(".k-expand-prev");

                ok(previousArrow.is(".k-expand-prev"));
                ok(previousArrow.is(":not(.k-collapse-prev)"));
            });

            test("toggle(false) disables splitbar resize", function() {
                var splitter = $(getSplitterHtml())
                        .appendTo(document.body)
                        .kendoSplitter({
                            panes: [ { collapsible: true }, {} ]
                        });

                splitter.data("kendoSplitter").toggle(".k-pane:first", false);

                ok(!splitter.find(".k-splitbar").hasClass("k-splitbar-draggable-horizontal"));
            });

            test("toggle(true) removes splibar hover style", function() {
                var splitter = $(getSplitterHtml())
                        .appendTo(document.body)
                        .kendoSplitter({
                            panes: [ { collapsible: true, collapsed: true }, {} ]
                        });

                splitter.find(".k-splitbar").addClass("k-splitbar-horizontal-hover");

                splitter.data("kendoSplitter").toggle(".k-pane:first", false);

                ok(!splitter.find(".k-splitbar").hasClass("k-splitbar-horizontal-hover"));
            });

            test("toggle(true) toggles pane state", function() {
                var splitter = $(getSplitterHtml())
                        .appendTo(document.body)
                        .kendoSplitter({
                            panes: [ { collapsible: true, collapsed: true }, {} ]
                        }),
                    pane = splitter.find(".k-pane:first");

                splitter.data("kendoSplitter").toggle(pane, true);

                ok(!pane.data("pane").collapsed);

                splitter = $(getSplitterHtml())
                    .appendTo(document.body)
                    .kendoSplitter({
                        panes: [ {}, { collapsible: true, collapsed: true } ]
                    });

                pane = splitter.find(".k-pane:last")

                splitter.data("kendoSplitter").toggle(pane, true);

                ok(!pane.data("pane").collapsed);
            });

            test("toggle(true) triggers resize", function() {
                var triggered = false,
                splitter = $(getSplitterHtml())
                .appendTo(document.body)
                .kendoSplitter({
                    panes: [ { collapsible: true, collapsed: true }, {} ],
                    resize: function() {
                        triggered = true;
                    }
                });

                splitter.data("kendoSplitter").toggle(".k-pane:first", true);

                ok(triggered);
            });

            test("toggle(true) converts associated arrow to collapse arrow", function() {
                var splitter = $(getSplitterHtml())
                        .appendTo(document.body)
                        .kendoSplitter({
                            panes: [ { collapsible: true, collapsed: true }, {} ]
                        });

                splitter.data("kendoSplitter").toggle(".k-pane:first", true);

                var previousArrow = splitter.find(".k-collapse-prev");

                ok(previousArrow.is(".k-collapse-prev"));
                ok(previousArrow.is(":not(.k-expand-prev)"));
            });

            test("toggle(true) enables splitbar resize", function() {
                var splitter = $(getSplitterHtml())
                        .appendTo(document.body)
                        .kendoSplitter({
                            panes: [ { collapsible: true, collapsed: true }, {} ]
                        });

                splitter.data("kendoSplitter").toggle(".k-pane:first", true);

                ok(splitter.find(".k-splitbar").hasClass("k-splitbar-draggable-horizontal"));
            });

            test("toggle(true) does not add splibar hover style", function() {
                var splitter = $(getSplitterHtml())
                        .appendTo(document.body)
                        .kendoSplitter({
                            panes: [ { collapsible: true, collapsed: true }, {} ]
                        });

                splitter.data("kendoSplitter").toggle(".k-pane:first", true);

                ok(!splitter.find(".k-splitbar").hasClass("k-splitbar-horizontal-hover"));
            });

            test("toggle() without arguments toggles pane collapsed state", function() {
                var splitter = $(getSplitterHtml())
                        .appendTo(document.body)
                        .kendoSplitter({
                            panes: [ { collapsible: true, collapsed: true }, {} ]
                        });

                splitter.data("kendoSplitter").toggle(".k-pane:first");
                ok(!splitter.find(".k-pane:first").data("pane").collapsed);

                splitter.data("kendoSplitter").toggle(".k-pane:first");
                ok(splitter.find(".k-pane:first").data("pane").collapsed);

                splitter.remove();
                splitter = $(getSplitterHtml())
                    .appendTo(document.body)
                    .kendoSplitter({
                        panes: [ { collapsible: true }, {} ]
                    });

                splitter.data("kendoSplitter").toggle(".k-pane:first");
                ok(splitter.find(".k-pane:first").data("pane").collapsed);

                splitter.data("kendoSplitter").toggle(".k-pane:first");
                ok(!splitter.find(".k-pane:first").data("pane").collapsed);
            });

            test("collapse() calls toggle(false)", function() {
                var args,
                    splitter = $(getSplitterHtml())
                        .appendTo(document.body)
                        .kendoSplitter({
                            panes: [ { collapsible: true }, {} ]
                        }).data("kendoSplitter");

                splitter.toggle = function() {
                    args = arguments;
                };

                splitter.collapse(".k-pane:last");

                ok(args);
                equal(args.length, 2);
                equal(args[0], ".k-pane:last");
                equal(args[1], false);
            });

            test("expand() calls toggle(true)", function() {
                var args,
                    splitter = $(getSplitterHtml())
                        .appendTo(document.body)
                        .kendoSplitter({
                            panes: [ { collapsible: true }, {} ]
                        }).data("kendoSplitter");

                splitter.toggle = function() {
                    args = arguments;
                };

                splitter.expand(".k-pane:last");

                ok(args);
                equal(args.length, 2);
                equal(args[0], ".k-pane:last");
                equal(args[1], true);
            });

            test("size() gets/sets pane size", function() {
                var splitter = $(getSplitterHtml())
                        .appendTo(document.body)
                        .kendoSplitter({
                            panes: [ { size: "110px" }, {} ]
                        }).data("kendoSplitter"),
                    firstPane = $(".k-pane:first", splitter.element);

                equals(splitter.size(firstPane), "110px");

                splitter.size(firstPane, "120px");

                equals(splitter.size(firstPane), "120px");
            });

            test("min() gets/sets pane min", function() {
                var splitter = $(getSplitterHtml())
                        .appendTo(document.body)
                        .kendoSplitter({
                            panes: [ { min: "110px", size: "200px" }, {} ]
                        }).data("kendoSplitter"),
                    firstPane = $(".k-pane:first", splitter.element);

                equals(splitter.min(firstPane), "110px");

                splitter.min(firstPane, "120px");

                equals(splitter.min(firstPane), "120px");
            });

            test("max() gets/sets pane max", function() {
                var splitter = $(getSplitterHtml())
                        .appendTo(document.body)
                        .kendoSplitter({
                            panes: [ { max: "200px", size: "110px" }, {} ]
                        }).data("kendoSplitter"),
                    firstPane = $(".k-pane:first", splitter.element);

                equals(splitter.max(firstPane), "200px");

                splitter.max(firstPane, "120px");

                equals(splitter.max(firstPane), "120px");
            });

            test("size(value) triggers resize", function() {
                var triggered = false,
                    splitter = $(getSplitterHtml())
                        .appendTo(document.body)
                        .kendoSplitter({
                            panes: [ { size: "110px" }, {} ]
                        })
                        .data("kendoSplitter")
                        .bind("resize", function() {
                            triggered = true;
                        });

                splitter.size(".k-pane:first", "120px");

                ok(triggered);
            });

            test("ajaxRequest() with remote URL", function() {
                var splitter = $(getSplitterHtml())
                        .appendTo(document.body)
                        .kendoSplitter({
                            panes: [ {}, {} ]
                        }),
                    url = "http://google.com";

                splitter.data("kendoSplitter").ajaxRequest(".k-pane:first", url);

                var pane = splitter.find(".k-pane:first"),
                    iframe = pane.find("> iframe");

                equals(iframe.length, 1);
                equals(iframe.attr("src"), url);
                ok(!pane.hasClass("k-scrollable"));
            });

            test("Splitter does not collapse uncollapsable pane", function() {
                var splitter = $(getSplitterHtml(2))
                        .appendTo(document.body)
                        .kendoSplitter({
                            panes: [ { collapsible: false }, { collapsible: false }]
                        });

                splitter.data("kendoSplitter").toggle(splitter.find(".k-scrollable:first"), false);

                equal(splitter.find(".k-pane:first").data("pane").collapsed, undefined);
            });
        </script>
        <div id="qunit-fixture">test markup, will be hidden</div>
        <ul id="log"></ul>
    </body>
</html>
