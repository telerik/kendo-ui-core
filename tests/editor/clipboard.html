<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>kendo.ui.Editor Tests</title>

    <script src="../jquery-loader.js"></script>
        <script src="test-scripts.js"></script>

        <style> html { font-size: 12px; } </style>
    </head>
    <body>

        <div><textarea cols="20" rows="4" id="Editor1" name="Editor1"></textarea></div>

        <div contentEditable id="inline"></div>

        <script>

            var editor = $("#Editor1").kendoEditor().data("kendoEditor");

            var inline = $("#inline").kendoEditor().data("kendoEditor");

            module("Clipboard");

            function pasteIn(target, initialContent, content) {
                target = target || editor;

                if (initialContent.indexOf("|") >= 0) {
                    target.selectRange(createRangeFromText(target, initialContent));
                } else {
                    target.value(initialContent);
                }

                target.clipboard.paste(content);
            }

            test("paste empty content", function() {
                pasteIn(editor, 'fo||o', '');

                var range = editor.getRange();
                equal(editor.value(), 'foo');
                equal(range.startOffset, 2);
                equal(range.startContainer, editor.body.firstChild);
                ok(range.collapsed);
            });

            test("paste text inserts it at caret position", function() {
                pasteIn(editor, 'fo||o', 'bar');

                var range = editor.getRange();
                equal(editor.value(), 'fobaro');
                equal(range.startOffset, 5);
                equal(range.startContainer, editor.body.firstChild);
                ok(range.collapsed);
            });

            test("paste inline inserts it at caret position", function() {
                pasteIn(editor, 'fo||o', 'bar<strong>baz</strong>');

                equal(editor.value(), 'fobar<strong>baz</strong>o');
            });

            test("paste inline in inline", function() {
                pasteIn(editor, '<strong>fo||o</strong>', '<em>baz</em>');

                equal(editor.value(), '<strong>fo</strong><em>baz</em><strong>o</strong>');
            });

            test("paste deletes contents", function() {
                pasteIn(editor, '<strong>|foo|</strong>', 'bar');

                equal(editor.value(), 'bar');
            });

            test("paste single block in inline", function() {
                pasteIn(editor, '<strong>fo||o</strong>', '<div>bar</div>');

                equal(editor.value(), '<strong>fo</strong><div>bar</div><strong>o</strong>');
            });

            test("paste block in paragraph splits the paragraph", function() {
                pasteIn(editor, '<p>fo||o</p>', '<div>bar</div>');

                equal(editor.value(), '<p>fo</p><div>bar</div><p>o</p>');
            });

            test("paste block in paragraph which contains inline splits the paragraph", function() {
                pasteIn(editor, '<p><span>fo||o</span></p>', '<div>bar</div>');

                equal(editor.value(), '<p><span>fo</span></p><div>bar</div><p><span>o</span></p>');
            });

            test("paste inline content in block element does not split", function() {
                pasteIn(editor, '<p>fo||o</p>', 'bar');

                equal(editor.value(), '<p>fobaro</p>');
            });

            test("paste inline content in block with inline child element splits", function() {
                pasteIn(editor, '<p><span>fo||o</span></p>', 'bar');

                equal(editor.value(), '<p><span>fo</span>bar<span>o</span></p>');
            });

            test("paste inline content in block with nested inline child element splits", function() {
                pasteIn(editor, '<p><span><strong>fo||o</strong></span></p>', 'bar');

                equal(editor.value(), '<p><span><strong>fo</strong></span>bar<span><strong>o</strong></span></p>');
            });

            test("paste does not strip empty elements", function() {
                pasteIn(editor, '<p><img />fo||o</p>', 'bar');

                equal(editor.value(), '<p><img />fobaro</p>');
            });

            test("paste block in li splits ul", function() {
                pasteIn(editor, '<ul><li>fo||o</li></ul>', '<div>bar</div>');

                equal(editor.value(), '<ul><li>fo</li></ul><div>bar</div><ul><li>o</li></ul>');
            });

            test("paste block in td does not split", function() {
                pasteIn(editor, '<table><tr><td>fo||o</td></tr></table>', '<div>bar</div>');

                equal(editor.value(), '<table><tbody><tr><td>fo<div>bar</div>o</td></tr></tbody></table>');
            });

            test("paste invalid list markup", function() {
                pasteIn(editor, 'f||oo', '<li>foo</li>');

                equal(editor.value(), 'f<ul><li>foo</li></ul>oo');
            });

            test("paste multiple lines from notepad", function() {
                pasteIn(editor, 'f||oo', '<div class="k-paste-container">bar</div><div class="k-paste-container">baz</div>');

                equal(editor.value(), 'fbar<br />bazoo');
            });

            test("paste of special characters", function() {
                pasteIn(editor, "", "Ï€");

                equal(editor.value(), '&pi;');
            });

            test("paste in root of inline editor does not replace its body", function() {
                pasteIn(inline, 'f||oo', '<p>bar</p>');

                equal(inline.value(), 'f<p>bar</p>oo');
            });

        </script>

        <h1 id="qunit-header">kendo.ui.Editor Tests</h1>
        <h2 id="qunit-banner"></h2>
        <div id="qunit-testrunner-toolbar"></div>
        <h2 id="qunit-userAgent"></h2>
        <ol id="qunit-tests"></ol>
        <div id="qunit-fixture">test markup, will be hidden</div>
        <ul id="log"></ul>

    </body>
</html>
