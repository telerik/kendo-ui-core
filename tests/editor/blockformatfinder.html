<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>kendo.ui.Editor Tests</title>

        <script src="../../src/jquery.js"></script>
        <script src="../qunit/qunit/qunit.js"></script>
        <script src="../qunit-runner.js"></script>
        <script src="../../src/kendo.core.js"></script>
        <script src="../../src/kendo.fx.js"></script>
        <script src="../../src/kendo.data.js"></script>
        <script src="../../src/kendo.popup.js"></script>
        <script src="../../src/kendo.list.js"></script>
        <script src="../../src/kendo.combobox.js"></script>
        <script src="../../src/kendo.dropdownlist.js"></script>
        <script src="../../src/kendo.window.js"></script>
        <script src="../../src/kendo.color.js"></script>
        <script src="../../src/kendo.editor.js"></script>
        <script src="util.js"></script>

        <link rel="stylesheet" href="../qunit/qunit/qunit.css" />
        <link rel="stylesheet" href="../../styles/web/kendo.common.css" />

        <style> html { font-size: 12px; } </style>
    </head>
    <body>

        <div><textarea cols="20" rows="4" id="Editor1" name="Editor1"></textarea></div>

        <script>

            $("#Editor1").kendoEditor();

            var BlockFormatFinder;

            module("Editor / BlockFormatFinder", {
                setup: function() {
                    editor = getEditor();
                    BlockFormatFinder = kendo.ui.editor.BlockFormatFinder;
                }
            });

            test("findSuitable returns suitable container", function() {
                editor.value("<div>foo</div>");
                var finder = new BlockFormatFinder(editor.options.formats.justifyCenter);

                equal(finder.findSuitable([editor.body.firstChild.firstChild])[0], editor.body.firstChild);
            });

            test("findSuitable returns null if no suitable found", function() {
                editor.value("foo");
                var finder = new BlockFormatFinder(editor.options.formats.justifyCenter);
                equal(finder.findSuitable([editor.body.firstChild]).length, 0);
            });

            test("findSuitable returns all suitable nodes null if no suitable found", function() {
                editor.value("<div>foo</div><div>bar</div>");
                var finder = new BlockFormatFinder(editor.options.formats.justifyCenter);
                equal(finder.findSuitable([editor.body.firstChild.firstChild, editor.body.lastChild.firstChild]).length, 2);
            });

            test("findSuitable returns distinct nodes", function() {
                editor.value("<div><span>foo</span><span>bar</span></div><div>baz</div>");
                var finder = new BlockFormatFinder(editor.options.formats.justifyCenter);
                equal(finder.findSuitable([editor.body.firstChild.firstChild.firstChild, editor.body.firstChild.lastChild.firstChild, editor.body.lastChild.firstChild]).length, 2);
            });

            test("findSuitable looks for common ancestor which is suitable", function() {
                editor.value("<div>foo</div>bar");
                var finder = new BlockFormatFinder(editor.options.formats.justifyCenter);
                equal(finder.findSuitable([editor.body.firstChild.firstChild, editor.body.lastChild]).length, 0);
            });

            test("findSuitable looks for the outer most common ancestor which is suitable", function() {
                editor.value("<div><div>foo</div>bar</div>");
                var finder = new BlockFormatFinder(editor.options.formats.justifyCenter);

                equal(finder.findSuitable([editor.body.firstChild.firstChild.firstChild, editor.body.firstChild.lastChild])[0], editor.body.firstChild);
            });

            test("findSuitable returns the inner suitable ancestor", function() {
                editor.value("<div><div>foo</div></div>");
                var finder = new BlockFormatFinder(editor.options.formats.justifyCenter);

                equal(finder.findSuitable([editor.body.firstChild.firstChild.firstChild])[0], editor.body.firstChild.firstChild);
            });

            test("findSuitable tests against node in argument", function() {
                editor.value("<div></div>");
                var finder = new BlockFormatFinder(editor.options.formats.justifyCenter);

                equal(finder.findSuitable([editor.body.firstChild])[0], editor.body.firstChild);
            });

            test("findFormat finds formatted node by tag", function() {
                editor.value('<div style="text-align:center">foo</strong>');

                var finder = new BlockFormatFinder(editor.options.formats.justifyCenter);

                equal(finder.findFormat(editor.body.firstChild.firstChild), editor.body.firstChild);
            });

            test("findSuitable finds td", function() {
                editor.value("<table><tr><td>foo</td></tr></table>");

                var finder = new BlockFormatFinder(editor.options.formats.justifyCenter);

                var td = $("td", editor.body)[0];
                equal(finder.findSuitable([td.firstChild])[0], td);
            });

            test("findFormat returns null if node does not match tag and style", function() {
                editor.value("<div>foo</div>");

                var finder = new BlockFormatFinder(editor.options.formats.justifyCenter);

                ok(null === finder.findFormat(editor.body.firstChild.firstChild));
            });

            test("findFormat checks all formats", function() {
                editor.value('<p style="text-align:center">foo</p>');

                var finder = new BlockFormatFinder(editor.options.formats.justifyCenter);

                equal(finder.findFormat(editor.body.firstChild.firstChild), editor.body.firstChild);
            });

            test("isFormatted checks all formats", function() {
                editor.value('<p style="text-align:center">foo</p>');

                var finder = new BlockFormatFinder(editor.options.formats.justifyCenter);

                ok(finder.isFormatted([editor.body.firstChild.firstChild]));
            });

            test("isFormatted returns true if all nodes are formatted", function() {
                editor.value('<div style="text-align:center">foo</div>');

                var finder = new BlockFormatFinder(editor.options.formats.justifyCenter);
                ok(finder.isFormatted([editor.body.firstChild.firstChild]));
            });

            test("isFormatted returns true for formatted and unformatted nodes", function() {
                editor.value('<div style="text-align:center">foo</div>bar');

                var finder = new BlockFormatFinder(editor.options.formats.justifyCenter);
                ok(!finder.isFormatted([editor.body.firstChild.firstChild, editor.body.lastChild]));
            });

            test("isFormatted returns true for image", function() {
                editor.value('<img style="float:right" />');

                var finder = new BlockFormatFinder(editor.options.formats.justifyRight);
                ok(finder.isFormatted([editor.body.firstChild]));
            });

            test("getFormat on single node", function() {
                editor.value("<h1>foo</h1>");
                var finder = new BlockFormatFinder([{ tags: "div,p,h1,h2,h3,h4,h5,h6".split(",") }]);
                equal(finder.getFormat([editor.body.firstChild.firstChild]), "h1");
            });

            test("getFormat on multiple different nodes", function() {
                editor.value("<h1>foo</h1><h2>bar</h2>");
                var finder = new BlockFormatFinder([{ tags: "div,p,h1,h2,h3,h4,h5,h6".split(",") }]);
                equal(finder.getFormat([editor.body.firstChild.firstChild, editor.body.lastChild.firstChild]), "");
            });

            test("getFormat on body does not throw error", function() {
                editor.value("foo");
                var finder = new BlockFormatFinder([{ tags: "div,p,h1,h2,h3,h4,h5,h6".split(",") }]);
                equal(finder.getFormat([editor.body]), "");
            });

        </script>

        <h1 id="qunit-header">kendo.ui.Editor Tests</h1>
        <h2 id="qunit-banner"></h2>
        <div id="qunit-testrunner-toolbar"></div>
        <h2 id="qunit-userAgent"></h2>
        <ol id="qunit-tests"></ol>
        <div id="qunit-fixture">test markup, will be hidden</div>
        <ul id="log"></ul>

    </body>
</html>
