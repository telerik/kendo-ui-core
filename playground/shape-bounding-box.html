<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" >
        <title>Spline</title>
        <link href="../styles/dataviz/kendo.dataviz.min.css" rel="stylesheet" />
        <script src="../src/jquery.js"></script>
        <script src="../src/kendo.core.js"></script>
        <script src="../src/kendo.data.js"></script>
        <script src="../src/kendo.binder.js"></script>
        <script src="../src/kendo.dataviz.core.js"></script>

         <script src="../src/dataviz/util.js"></script>
         <script src="../src/dataviz/geometry.js"></script>
         <script src="../src/dataviz/drawing/core.js"></script>
         <script src="../src/dataviz/drawing/shapes.js"></script>
         <script src="../src/dataviz/drawing/parser.js"></script>
         <script src="../src/dataviz/drawing/svg.js"></script>
         <script src="../src/dataviz/drawing/canvas.js"></script>
         <script src="../src/dataviz/drawing/vml.js"></script>
    </head>
    <body >
        <--
            <textarea id="pathString" cols="40" rows="5" data-bind="value:path"></textarea>
            <div data-bind="text:drawPath"></div>
           
         -->
          <div id="container" style="top:100px;"></div>
        <svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="1200px" height="1200px" style="position:absolute;">
            <g>
                <path data-bind="attr: {d: path}" stroke="red" stroke-width="2" stroke-linecap="square" fill="none" stroke-linejoin="round"></path>
            </g>           
        </svg>
        <!--
        <svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="1200px" height="1200px" style="position:absolute;left: 300px;">
            <g transform = "translate(0, 300)">
                <path d="M100,100 C200,200 300,200 400,100 L500,150 C450,200 200,300 100,200 z" transform = "rotate(-45 100 100) scale(1.1, 0.7)" stroke="red" stroke-width="2" stroke-linecap="square" fill="none" stroke-linejoin="round"></path>
            </g>           
        </svg>
          -->
         <!--
         <div id="test"></div>
        <svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="1200px" height="1200px" style="position:absolute; left: 300px;">
            <g>
                <path d="M 300 300 v 86.6 h-25 A 50 100 0 1 1 350 300 c -5 100 100 100 100 -100 10 -70 50 100 50 100" stroke="red" stroke-width="2" stroke-linecap="square" fill="none" stroke-linejoin="round"></path>
            </g>
        </svg>
         -->
        <!--
            <svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="400px" height="400px" style="position:absolute;">
                <g>
                    <path d="M400 300 A 100 50 0 1 1 250 256.7" stroke="red" stroke-width="2" stroke-linecap="square" fill="none" stroke-linejoin="round"></path>
                    <circle cx="300" cy="300" r="3" stroke="black" stroke-width="2" stroke-linecap="square" fill="none"></circle>
                </g>
            </svg>
        -->
     <!--
        <svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="700px" height="700px" style="position: absolute;">
            <g transform="scale(2,1)">
                <circle cx="300" cy="300" r="100" transform="rotate(30)" stroke="red" stroke-width="2" stroke-linecap="square" fill="none" stroke-linejoin="round" />
                <circle cx="300" cy="300" r="3" stroke="black" stroke-width="2" stroke-linecap="square" fill="none"></circle>
            </g>
        </svg>
      -->
        <script>
            //test curve M100 100 c 50 50 100 0 200 0 200 10 0 100 -50 100
            //test arc M275 386.6 A 50 100 0 0 0 350 300
            var dataviz = kendo.dataviz,
                geometry = dataviz.geometry,
                transform = geometry.transform,
                Point = geometry.Point,
                Circle = geometry.Circle,                
                drawing = dataviz.drawing,
                Path = drawing.Path,
                Group = drawing.Group,
                MultiPath = drawing.MultiPath,
                Segment = drawing.Segment,
                Surface = drawing.Surface,
                surface = Surface.create(document.getElementById("container"), {width: 1000, height: 1000}),
                circleGeometry = new Circle(Point.create(150, 400), 100),
                circle = new drawing.Circle(circleGeometry, {fill: {color: "red"} }),
               // boundingRect = circle.bbox(),
                strokeOptions = {stroke: {color: "black", width: 2}},
                //circleBoundingPath = rectPath(boundingRect, strokeOptions),
                curve = new Path(strokeOptions),
                group = new drawing.Group(),
                mainGroup;

            var arcGeometry = new geometry.Arc(Point.create(300, 300), {
                startAngle: 120,
                endAngle: 0,
                radiusX: 50,
                radiusY: 100,
                counterClockwise: false
            });
//M300 340 C 286 340 272.1 338.1 260 334.6
            var arc = new drawing.Arc(arcGeometry, strokeOptions);
            //group.append(arc, new drawing.Circle(new geometry.Circle(Point.create(300, 300), 3), strokeOptions), rectPath(arc.bbox(), strokeOptions));//circle, circleBoundingPath, curve, curveBoundingRect);
            //surface.draw(group);
            var viewModel = kendo.observable({
                path: "M100,100S 200,200 300 100s-50,250 150,50",//"M 300 300 v 86.6 h-25 A 50 100 0 1 1 350 300 c -5 100 100 100 100 -100 10 -70 50 100 50 100",//"M 300 300 A 50 100 0 1 1 350 300"
                drawPath: function() {
                    var pathString = this.get("path");
                    if (pathString) {
                        var multiPath = Path.parse(pathString, strokeOptions),
                            multiPathGroup =  new drawing.Group(),
                            multiPathBoundingRect = multiPath.bbox();

                       multiPathGroup.append(multiPath);//, rectPath(multiPathBoundingRect, strokeOptions));
                       surface.clear();
                       surface.draw(multiPathGroup);
                    }

                    return pathString;
                }
            });
            
            //arcTransformTest();
            function arcTransformTest() {
                arcGeometry = new geometry.Arc(Point.create(200, 500), {
                    startAngle: 90,
                    endAngle: 240,
                    radiusX: 50,
                    radiusY: 100,
                    counterClockwise: false
                });
                arc = new drawing.Arc(arcGeometry, $.extend({transform: transform().scale(1,2).rotate(-45).scale(2,1).matrix()}, strokeOptions));
                var group = new drawing.Group({transform: transform().translate(-100,100).matrix()});
                group.append(arc, rectPath(arc.bbox(), strokeOptions));
                surface.clear();
                surface.draw(group);
            }
            
          //  parentTransformationsTest();
            function parentTransformationsTest() {
                var group = new Group({transform: transform().scale(2,1).matrix()}),
                    mainGroup = new Group({transform: transform().scale(1,2).matrix()}),
                    path = new Path({transform: transform().translate(10,10).matrix()});
                //path.moveTo(0,0);
                mainGroup.append(group);
                group.append(path);
               // debugger;
                group.bbox();
            }
            
           // multipathTransformTest();
            function multipathTransformTest() {
                var curveTransform = new MultiPath($.extend({transform: transform().translate(100,400).scale(1.5,1).rotate(-90, 100, 100).matrix()}, strokeOptions));
                curveTransform.moveTo(100, 100);
                curveTransform.curveTo(Point.create(200, 200), Point.create(300, 200), Point.create(400, 100));
                curveTransform.lineTo(500, 150);
                curveTransform.curveTo(Point.create(550, 200), Point.create(200, 300), Point.create(100, 200));
                curveTransform.close();

                curveTransform.moveTo(50, 200);
                curveTransform.curveTo(Point.create(150, 190),
                        Point.create(150, 130),
                        Point.create(70, 80));
                curveTransform.lineTo(50, 100);
                curveTransform.lineTo(50, 200);
                var group = new drawing.Group();
                group.append(curveTransform, rectPath(curveTransform.bbox(), strokeOptions));
                
                surface.clear();
                surface.draw(group);
            }
            
            
            //circleTransformTest();
            function circleTransformTest() {
                var m = transform().scale(1,2).rotate(30).translate(500,-500).matrix();
                circleGeometry = new Circle(Point.create(250, 200), 100);
                var original = new drawing.Circle(circleGeometry, {stroke: {color: "red", width: 3}});
                circle = new drawing.Circle(circleGeometry, {stroke: {color: "red", width: 3}, transform: m});
                circleCenter = new drawing.Circle(new Circle(Point.create(150, 400), 2), {stroke: {color: "red", width: 3}, transform: m})
                    //});
                group = new drawing.Group({});
                group.append(circle);
                mainGroup = new drawing.Group();
                mainGroup.append(group, rectPath(group.bbox(), strokeOptions), original);
                
                surface.clear();
                surface.draw(mainGroup);
            }
            
            //curveTransformTest();            
            function curveTransformTest() {
                var curveTransform = new Path($.extend({transform: transform().translate(0, 100).scale(1,2).rotate(-45, 100, 100).scale(1.1, 0.7).matrix()}, strokeOptions)),
                    original = new Path({stroke: {color: "blue", width: 1}});
                testing = curveTransform;
                curveTransform.moveTo(100, 100);
                curveTransform.curveTo(Point.create(200, 200), Point.create(300, 200), Point.create(400, 100));
                curveTransform.lineTo(500, 150);
                curveTransform.curveTo(Point.create(450, 200), Point.create(200, 300), Point.create(100, 200));
                curveTransform.close();
                
                original.moveTo(100, 100);
                original.curveTo(Point.create(200, 200), Point.create(300, 200), Point.create(400, 100));
                original.lineTo(500, 150);
                original.curveTo(Point.create(450, 200), Point.create(200, 300), Point.create(100, 200));
                original.close(); 
                group = new drawing.Group({transform: transform().translate(0, 300).matrix()});
                group.append(curveTransform, rectPath(curveTransform.bbox(), strokeOptions));
                surface.clear();
               
                mainGroup = new drawing.Group();
                mainGroup.append(group, original);
                surface.draw(mainGroup);
            }
            
            kendo.bind($("body"), viewModel);

            function rectPath(rect, options) {
                var rectPath = new Path(options),
                    width = rect.width(),
                    height = rect.height();
                rectPath.moveTo(rect.p0.x, rect.p0.y);
                rectPath.lineTo(rect.p0.x + width, rect.p0.y);
                rectPath.lineTo(rect.p0.x + width, rect.p0.y + height);
                rectPath.lineTo(rect.p0.x, rect.p0.y + height);
                rectPath.close();

                return rectPath;
            }
            //renderTest();
            function renderTest() {
                var surface = Surface.create(document.getElementById("test"), {width: 700, height: 700}),
                    arcGeometry = new geometry.Arc(Point.create(100, 100), {
                        startAngle: 60,
                        endAngle: 240,
                        radiusX: 50,
                        radiusY: 100,
                        counterClockwise: false
                    }),
                    arc = new drawing.Arc(arcGeometry, {stroke: {color: "red", width: 20}});
                //var circ  =new drawing.Circle(new geometry.Circle(Point.create(300, 300), 100), {stroke: {color: "red", width: 100}});
                var group = new drawing.Group();
                
                //group.append(arc, rectPath(arc.bbox(), {stroke: {color: "black", width: 1}}));
               // group.append(circ, rectPath(circ.bbox(), {stroke: {color: "black", width: 1}}));
               
                var path = new Path({stroke: {color: "red", width: 1}});
                path.moveTo(0, 0);
                path.curveTo(new Point(-10, -10), new Point(-20, 30), new Point(30, 50));
                //path.curveTo(new Point(310, 50), new Point(400, 150), new Point(200, 300));
                // path.close();
                // var path2 = new Path({stroke: {color: "black", width: 1}});
                // path2.moveTo(100, 100);
                // path2.curveTo(new Point(150, 150), new Point(200, 150), new Point(300, 100));
                // path2.curveTo(new Point(310, 50), new Point(400, 150), new Point(200, 300));
                // path2.close();
                
               // group.append(path, rectPath(path.bbox(), {stroke: {color: "black", width: 1}}));//, path2);
               // surface.draw(group);
            }
        </script>
    </body>
</html>
